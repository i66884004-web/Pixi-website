<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixi Search â€” AI-powered search</title>
  <style>
    :root{ --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#8b5cf6; --glass: rgba(255,255,255,0.04);} 
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#071026 0%, #07172c 60%); color:#e6eef8}
    .container{max-width:1100px;margin:32px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    .logo{display:flex;flex-direction:column;justify-content:center}
    .brand{font-weight:700;font-size:20px;letter-spacing:0.6px}
    .tag{font-size:12px;color:var(--muted)}

    .searchbar{display:flex;gap:8px;margin-top:18px}
    .input{flex:1;background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:14px 16px;border-radius:12px;color:inherit;outline:none;box-shadow:0 4px 18px rgba(2,6,23,0.6)}
    .btn{background:linear-gradient(90deg,var(--accent),#5eead4);border:none;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);}

    main{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:22px}
    .results{display:flex;flex-direction:column;gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
    .title{font-size:16px;font-weight:700}
    .url{color:var(--muted);font-size:13px;margin-top:6px}
    .snippet{margin-top:8px;color:#cfe8ff}

    .right{position:relative}
    .pixi-panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:220px}
    .pixi-header{display:flex;align-items:center;justify-content:space-between}
    .pixi-history{max-height:360px;overflow:auto;margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .msg{padding:10px;border-radius:10px;max-width:88%}
    .msg.user{background:rgba(255,255,255,0.03);align-self:flex-end}
    .msg.pixi{background:rgba(139,92,246,0.12);align-self:flex-start}

    .footer-note{margin-top:18px;color:var(--muted);font-size:13px}

    @media (max-width:900px){main{grid-template-columns:1fr} .right{order:2}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="brand">Pixi Search</div>
        <div class="tag">search + ai assistant</div>
      </div>
    </header>

    <div class="searchbar">
      <input id="q" class="input" placeholder="Search the web or ask Pixi..." autocomplete="off" />
      <button id="searchBtn" class="btn">ðŸ”Ž Search</button>
      <button id="pixiBtn" class="btn secondary">âœ¨ Pixi</button>
    </div>

    <main>
      <section class="results" id="results"></section>

      <aside class="right">
        <div class="pixi-panel">
          <div class="pixi-header">
            <strong>Pixi â€” AI Assistant</strong>
            <button id="clearChat" class="btn secondary">Clear</button>
          </div>

          <div id="history" class="pixi-history"></div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <input id="pixiInput" class="input" placeholder="Ask Pixi anything..." />
            <button id="sendPixi" class="btn">Send</button>
          </div>
        </div>
        <div class="footer-note">
          This demo calls Netlify Functions at <code>/.netlify/functions/search</code>.
        </div>
      </aside>
    </main>
  </div>

  <script>
    const qEl = document.getElementById('q');
    const searchBtn = document.getElementById('searchBtn');
    const pixiBtn = document.getElementById('pixiBtn');
    const resultsEl = document.getElementById('results');

    const historyEl = document.getElementById('history');
    const pixiInput = document.getElementById('pixiInput');
    const sendPixi = document.getElementById('sendPixi');
    const clearChat = document.getElementById('clearChat');

    function el(tag, cls, txt){ const e=document.createElement(tag); if(cls) e.className=cls; if(txt) e.textContent=txt; return e }

    async function callAPI(mode, query) {
      const res = await fetch(`/.netlify/functions/search?q=${encodeURIComponent(query)}&mode=${mode}`);
      if(!res.ok) throw new Error("API failed: " + res.status);
      return res.json();
    }

    async function searchGoogle(query){
      resultsEl.innerHTML = '';
      const loading = el('div','card','Searching...');
      resultsEl.appendChild(loading);

      try{
        const data = await callAPI('google', query);
        resultsEl.innerHTML = '';
        (data.items || []).forEach(item=>{
          const c = el('div','card');
          const t = el('div','title'); t.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;
          const u = el('div','url', item.displayLink);
          const s = el('div','snippet', item.snippet);
          const aiBtn = el('button','btn secondary','Ask Pixi about this');
          aiBtn.addEventListener('click', ()=> pixiAsk(`Summarize this: ${item.title} â€” ${item.link}`));
          c.append(t,u,s,aiBtn);
          resultsEl.appendChild(c);
        });
      }catch(err){
        resultsEl.innerHTML='';
        resultsEl.appendChild(el('div','card','Error: '+err.message));
      }
    }

    async function pixiAsk(prompt){
      addHistory('user', prompt);
      const thinking = addHistory('pixi','Thinking...');
      try{
        const data = await callAPI('pixi', prompt);
        const reply = data.choices?.[0]?.message?.content?.trim() || 'No response.';
        thinking.textContent = reply;
      }catch(err){
        thinking.textContent = 'Error: ' + err.message;
      }
    }

    function addHistory(who,text){
      const m=el('div','msg '+(who==='user'?'user':'pixi'),text);
      historyEl.appendChild(m);
      historyEl.scrollTop=historyEl.scrollHeight;
      return m;
    }

    searchBtn.addEventListener('click', ()=>{ const q=qEl.value.trim(); if(q) searchGoogle(q) });
    qEl.addEventListener('keydown',(e)=>{ if(e.key==='Enter') searchBtn.click() });
    pixiBtn.addEventListener('click', ()=>{ const q=qEl.value.trim(); if(q) pixiAsk(q) });
    sendPixi.addEventListener('click', ()=>{ const p=pixiInput.value.trim(); if(p){ pixiInput.value=''; pixiAsk(p) } });
    pixiInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') sendPixi.click() });
    clearChat.addEventListener('click', ()=>{ historyEl.innerHTML='' });

    addHistory('pixi',"Hi, I'm Pixi! Type something or hit Search.");
  </script>
</body>
</html>

